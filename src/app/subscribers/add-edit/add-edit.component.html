<div class="container">
  <h1 class="title" *ngIf="isAddMode; else editTitle">Create Subscribers</h1>
  <ng-template #editTitle>
    <h1 class="title" *ngIf="subscriber">Edit {{ subscriber.Name }}</h1>
  </ng-template>
  <form [formGroup]="form" (ngSubmit)="onSubmit()">
    <div class="actions" *ngIf="isAddMode">
      <button (click)="addSubscriber()" mat-raised-button color="primary">
        <mat-icon>add</mat-icon>
        Add Subscriber
      </button>
    </div>
    <div formArrayName="Subscribers">
      <ng-container
        *ngFor="let subscriber of subscribers().controls; let i = index"
        [formGroupName]="i"
      >
        <div class="form">
          <mat-form-field appearance="outline">
            <mat-label>Name</mat-label>
            <input type="text" matInput formControlName="Name" />
            <mat-error> Name is required </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Email</mat-label>
            <input type="text" matInput formControlName="Email" />
            <mat-error> Please provide a valid Email address </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Job Title</mat-label>
            <input type="text" matInput formControlName="JobTitle" />
            <mat-error> Job Title is required </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Area</mat-label>
            <input type="text" matInput formControlName="Area" />
            <mat-error> Area is required </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Country Code</mat-label>
            <mat-select formControlName="CountryCode">
              <mat-option>
                <ngx-mat-select-search
                  placeholderLabel="Find country..."
                  noEntriesFoundLabel="'no matching country found'"
                  ngModel
                  (ngModelChange)="filterCountries($event)"
                  [ngModelOptions]="{ standalone: true }"
                ></ngx-mat-select-search>
              </mat-option>
              <mat-option
                *ngFor="let country of countries"
                [value]="country.Code"
                >{{ country.Code }}</mat-option
              >
            </mat-select>
            <mat-error> Country code and Phone are required </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Phone Number</mat-label>
            <input type="number" matInput formControlName="PhoneNumber" />
            <mat-error> Country code and Phone are required </mat-error>
          </mat-form-field>
        </div>
        <div class="actions" *ngIf="isAddMode">
          <button (click)="removeSubscriber(i)" mat-raised-button color="warn">
            <mat-icon>delete</mat-icon>
            Remove Subscriber
          </button>
        </div>
        <mat-divider *ngIf="isAddMode"></mat-divider>
      </ng-container>
    </div>

    <div class="actions">
      <button mat-raised-button routerLink="../">
        <mat-icon>cancel</mat-icon> Cancel
      </button>
      <button [disabled]="loading" mat-raised-button color="primary">
        <mat-icon>save</mat-icon>
        Create
      </button>
    </div>
  </form>
</div>
